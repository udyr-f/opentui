---
import Base from "../layouts/Base.astro"
import TuiSurface from "../components/TuiSurface.astro"

const installCommands = {
  create: { cmd: "bun create", pkg: "tui" },
  manual: { cmd: "bun add", pkg: "@opentui/core" },
}

const features = [
  {
    type: "layout",
    title: "Flexbox layout",
    description: "Yoga-powered layout engine with familiar CSS-like positioning and sizing"
  },
  {
    type: "syntax",
    title: "Syntax highlighting",
    description: "Built-in tree-sitter integration for beautiful code rendering"
  },
  {
    type: "components",
    title: "Rich components",
    description: "Text, Box, Input, Select, ScrollBox, Code, Diff, and more"
  },
  {
    type: "keyboard",
    title: "Keyboard handling",
    description: "Focus management and input handling built in"
  },
  {
    type: "react",
    title: "React and Solid.js",
    description: "First-class bindings for building UIs with your favorite framework"
  },
  {
    type: "animations",
    title: "Animations",
    description: "Timeline API for smooth, performant terminal animations"
  },
]
---

<Base title="OpenTUI - Terminal UIs in TypeScript">
  <main class="landing">
    <div class="landing-container">
      <!-- Header -->
      <header class="landing-header">
        <a href="/opentui/" class="landing-logo">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="3" width="20" height="18" fill="currentColor" />
            <rect x="6" y="8" width="3" height="8" fill="hsl(0, 20%, 99%)" />
          </svg>
          OpenTUI
        </a>
        <button
          class="mobile-menu-btn"
          aria-label="Open navigation menu"
          aria-expanded="false"
          aria-controls="landing-mobile-nav"
        >
          <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
            <rect x="5" y="8" width="14" height="2"></rect>
            <rect x="5" y="14" width="14" height="2"></rect>
          </svg>
          <svg class="close-icon" viewBox="0 0 24 24" fill="currentColor">
            <rect x="5" y="11" width="14" height="2" transform="rotate(45 12 12)"></rect>
            <rect x="5" y="11" width="14" height="2" transform="rotate(-45 12 12)"></rect>
          </svg>
        </button>
        <nav class="landing-nav">
          <a href="/opentui/docs/getting-started">Docs</a>
          <a href="https://github.com/anomalyco/opentui" target="_blank" rel="noopener noreferrer">GitHub</a>
        </nav>
      </header>

      <!-- Mobile nav overlay -->
      <nav class="mobile-nav" id="landing-mobile-nav">
        <a href="/opentui/docs/getting-started">Docs</a>
        <a href="https://github.com/anomalyco/opentui" target="_blank" rel="noopener noreferrer">GitHub</a>
      </nav>

      <!-- Content -->
      <div class="landing-content">
        <!-- Hero -->
        <section class="hero">
          <div class="hero-content">
            <div class="hero-copy">
              <h1>Terminal UIs in TypeScript</h1>
              <p class="hero-subtitle">
                Build rich, interactive terminal interfaces with flexbox layouts and first-class TypeScript support.
              </p>
            </div>

            <!-- Install Tabs -->
            <div class="install-section" aria-label="Install options">
              <div class="install-tabs" role="tablist">
                {Object.keys(installCommands).map((key, i) => (
                  <button 
                    role="tab" 
                    class="install-tab" 
                    data-tab={key}
                    aria-selected={i === 0 ? "true" : "false"}
                  >
                    {key}
                  </button>
                ))}
              </div>
              <div class="install-panels">
                <button class="install-command" id="install-display" data-command="bun create tui">
                  <code>
                    <span class="cmd">bun create </span><span class="highlight">tui</span>
                  </code>
                  <span class="copy-btn">
                    <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path d="M8.75 8.75V2.75H21.25V15.25H15.25M15.25 8.75H2.75V21.25H15.25V8.75Z" stroke-linecap="square"/>
                    </svg>
                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M2.75 15.0938L9 20.25L21.25 3.75" stroke-linecap="square"/>
                    </svg>
                  </span>
                </button>
              </div>
            </div>
          </div>

        </section>

        <!-- Code Example -->
        <section class="code-section">
          <div class="code-editor">
            <div class="code-editor-header">
              <div class="code-editor-dots">
                <span></span><span></span><span></span>
              </div>
              <div class="code-editor-tabs" role="tablist">
                <button role="tab" class="code-editor-tab" data-tab="core" aria-selected="true">
                  <svg class="code-editor-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                    <polyline points="13 2 13 9 20 9"/>
                  </svg>
                  hello.ts
                </button>
                <button role="tab" class="code-editor-tab" data-tab="solid" aria-selected="false">
                  <svg class="code-editor-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                    <polyline points="13 2 13 9 20 9"/>
                  </svg>
                  input.ts
                </button>
                <button role="tab" class="code-editor-tab" data-tab="layout" aria-selected="false">
                  <svg class="code-editor-tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                    <polyline points="13 2 13 9 20 9"/>
                  </svg>
                  layout.ts
                </button>
              </div>
              <button class="code-editor-copy" id="code-copy-btn" aria-label="Copy code">
                <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M8.75 8.75V2.75H21.25V15.25H15.25M15.25 8.75H2.75V21.25H15.25V8.75Z" stroke-linecap="square"/>
                </svg>
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M2.75 15.0938L9 20.25L21.25 3.75" stroke-linecap="square"/>
                </svg>
              </button>
            </div>
            
            <!-- Core API Example -->
            <div class="code-editor-body" data-panel="core" data-active="true">
              <div class="code-editor-lines">
                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
              </div>
              <pre><code><span class="keyword">import</span> {"{"} createCliRenderer, Text {"}"} <span class="keyword">from</span> <span class="string">"@opentui/core"</span>

<span class="keyword">const</span> renderer <span class="operator">=</span> <span class="keyword">await</span> <span class="function">createCliRenderer</span>()

renderer.root.<span class="function">add</span>(
  <span class="function">Text</span>({"{"}
    <span class="property">content</span><span class="operator">:</span> <span class="string">"Hello, OpenTUI!"</span>,
    <span class="property">fg</span><span class="operator">:</span> <span class="string">"#00FF00"</span>,
  {"}"})
)</code></pre>
            </div>
            
            <!-- Input Example -->
            <div class="code-editor-body" data-panel="solid" data-active="false">
              <div class="code-editor-lines">
                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span>
              </div>
              <pre><code><span class="keyword">import</span> {"{"} createCliRenderer, Input {"}"} <span class="keyword">from</span> <span class="string">"@opentui/core"</span>

<span class="keyword">const</span> renderer <span class="operator">=</span> <span class="keyword">await</span> <span class="function">createCliRenderer</span>()

<span class="keyword">const</span> input <span class="operator">=</span> <span class="function">Input</span>({"{"}
  <span class="property">placeholder</span><span class="operator">:</span> <span class="string">"Type something..."</span>,
  <span class="property">width</span><span class="operator">:</span> <span class="number">30</span>,
{"}"})

input.<span class="function">focus</span>()
renderer.root.<span class="function">add</span>(input)</code></pre>
            </div>
            
            <!-- Layout Example -->
            <div class="code-editor-body" data-panel="layout" data-active="false">
              <div class="code-editor-lines">
                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span>
              </div>
              <pre><code><span class="keyword">import</span> {"{"} createCliRenderer, Box, Text {"}"} <span class="keyword">from</span> <span class="string">"@opentui/core"</span>

<span class="keyword">const</span> renderer <span class="operator">=</span> <span class="keyword">await</span> <span class="function">createCliRenderer</span>()

renderer.root.<span class="function">add</span>(
  <span class="function">Box</span>(
    {"{"} <span class="property">width</span><span class="operator">:</span> <span class="string">"100%"</span>, <span class="property">height</span><span class="operator">:</span> <span class="string">"100%"</span>, <span class="property">flexDirection</span><span class="operator">:</span> <span class="string">"row"</span>, <span class="property">gap</span><span class="operator">:</span> <span class="number">2</span> {"}"},
    <span class="function">Box</span>(
      {"{"} <span class="property">flexGrow</span><span class="operator">:</span> <span class="number">1</span>, <span class="property">backgroundColor</span><span class="operator">:</span> <span class="string">"#1a1b26"</span> {"}"},
      <span class="function">Text</span>({"{"} <span class="property">content</span><span class="operator">:</span> <span class="string">"Sidebar"</span>, <span class="property">fg</span><span class="operator">:</span> <span class="string">"#bb9af7"</span> {"}"})
    ),
    <span class="function">Box</span>({"{"} <span class="property">flexGrow</span><span class="operator">:</span> <span class="number">3</span>, <span class="property">backgroundColor</span><span class="operator">:</span> <span class="string">"#24283b"</span> {"}"}, <span class="function">Text</span>({"{"} <span class="property">content</span><span class="operator">:</span> <span class="string">"Main"</span> {"}"}))
  )
)</code></pre>
            </div>
          </div>
        </section>

        <!-- What is OpenTUI -->
        <section class="what-section">
          <div class="what-section-title">
            <h3>What is OpenTUI?</h3>
            <p>OpenTUI is a TypeScript library for building rich, interactive terminal user interfaces.</p>
          </div>
          
          <div class="features-split">
            <div class="features-list">
              <ul class="what-list">
                {features.map((feature, i) => (
                  <li class={`feature-item ${i === 0 ? 'active' : ''}`} data-feature={feature.type} tabindex="0">
                    <span class="bullet">[{i === 0 ? 'o' : '*'}]</span>
                    <div><strong>{feature.title}</strong> {feature.description}</div>
                  </li>
                ))}
              </ul>
              
              <div class="what-actions">
                <a href="/opentui/docs/getting-started" class="btn-dark">
                  <span>Read docs</span>
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.5 12L17 12M13 16.5L17.5 12L13 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="square"/>
                  </svg>
                </a>
              </div>
            </div>
            
            <div class="features-visual">
              <TuiSurface />
            </div>
          </div>
        </section>

        <!-- Footer -->
        <footer class="landing-footer">
          <div class="landing-footer-cell"><a href="https://github.com/anomalyco/opentui" target="_blank" rel="noopener noreferrer">GitHub</a></div>
          <div class="landing-footer-cell"><a href="/opentui/docs/getting-started">Docs</a></div>
        </footer>
      </div>
    </div>

    <!-- Legal - outside container, centered -->
    <div class="landing-legal">
      <span>&copy; 2026 <a href="https://anoma.ly">Anomaly</a></span>
    </div>
  </main>
</Base>

<script>
  const installCommands: Record<string, { cmd: string; pkg: string }> = {
    create: { cmd: "bun create", pkg: "tui" },
    manual: { cmd: "bun add", pkg: "@opentui/core" },
  }

  // Tab switching
  const tabs = document.querySelectorAll('.install-tab')
  const commandBtn = document.getElementById('install-display') as HTMLButtonElement
  
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const key = tab.getAttribute('data-tab') as keyof typeof installCommands
      const { cmd, pkg } = installCommands[key]
      
      // Update active tab
      tabs.forEach(t => t.setAttribute('aria-selected', 'false'))
      tab.setAttribute('aria-selected', 'true')
      
      // Update command display
      if (commandBtn) {
        const codeEl = commandBtn.querySelector('code')
        if (codeEl) {
          codeEl.innerHTML = `<span class="cmd">${cmd} </span><span class="highlight">${pkg}</span>`
        }
        commandBtn.setAttribute('data-command', `${cmd} ${pkg}`)
      }
    })
  })

  // Copy functionality - clicking the whole command button copies
  if (commandBtn) {
    commandBtn.addEventListener('click', async () => {
      const command = commandBtn.getAttribute('data-command')
      if (command) {
        await navigator.clipboard.writeText(command)
        const copyBtn = commandBtn.querySelector('.copy-btn')
        if (copyBtn) {
          copyBtn.classList.add('copied')
          setTimeout(() => copyBtn.classList.remove('copied'), 1500)
        }
      }
    })
  }

  // Code editor tab switching
  const editorTabs = document.querySelectorAll('.code-editor-tab')
  const editorPanels = document.querySelectorAll('.code-editor-body')
  
  editorTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabId = tab.getAttribute('data-tab')
      
      editorTabs.forEach(t => t.setAttribute('aria-selected', 'false'))
      tab.setAttribute('aria-selected', 'true')
      
      editorPanels.forEach(panel => {
        panel.setAttribute('data-active', panel.getAttribute('data-panel') === tabId ? 'true' : 'false')
      })
    })
  })

  // Feature switching logic
  const featureItems = document.querySelectorAll('.feature-item');
  
  featureItems.forEach(item => {
    item.addEventListener('click', () => {
      // Update UI
      featureItems.forEach(i => {
        i.classList.remove('active');
        const bull = i.querySelector('.bullet');
        if (bull) bull.textContent = '[*]';
      });
      item.classList.add('active');
      const bull = item.querySelector('.bullet');
      if (bull) bull.textContent = '[o]';
      
      // Dispatch event
      const feature = item.getAttribute('data-feature');
      window.dispatchEvent(new CustomEvent('feature-change', { detail: feature }));
    });
    
    // Keyboard support
    item.addEventListener('keydown', (e: any) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        (item as HTMLElement).click();
      }
    });
  });

  const codeCopyBtn = document.getElementById('code-copy-btn')
  
  if (codeCopyBtn) {
    codeCopyBtn.addEventListener('click', async () => {
      const activePanel = document.querySelector('.code-editor-body[data-active="true"]')
      if (activePanel) {
        const codeEl = activePanel.querySelector('pre code')
        if (codeEl) {
          const code = codeEl.textContent || ''
          await navigator.clipboard.writeText(code)
          
          codeCopyBtn.classList.add('copied')
          setTimeout(() => codeCopyBtn.classList.remove('copied'), 1500)
        }
      }
    })
  }

  // Mobile menu toggle
  const menuBtn = document.querySelector('.mobile-menu-btn')
  const mobileNav = document.querySelector('.mobile-nav')

  function openMenu() {
    document.body.classList.add('mobile-nav-open')
    menuBtn?.setAttribute('aria-expanded', 'true')
    menuBtn?.setAttribute('aria-label', 'Close navigation menu')
  }

  function closeMenu() {
    document.body.classList.remove('mobile-nav-open')
    menuBtn?.setAttribute('aria-expanded', 'false')
    menuBtn?.setAttribute('aria-label', 'Open navigation menu')
  }

  menuBtn?.addEventListener('click', () => {
    const isOpen = document.body.classList.contains('mobile-nav-open')
    if (isOpen) {
      closeMenu()
    } else {
      openMenu()
    }
  })

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && document.body.classList.contains('mobile-nav-open')) {
      closeMenu()
    }
  })

  mobileNav?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', closeMenu)
  })
</script>
